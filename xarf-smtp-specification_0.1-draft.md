# X-ARF over SMTP *v0.1-draft00*

This is a short specification for transporting X-ARF messages over SMTP.

X-ARF can be transported via SMTP in one of three ways:

* Plain, which is a single X-ARF report in the body of a message.
* Secure, which uses S/MIME or PGP/MIME to provide security for an X-ARF report
* Bulk, which transports multiple plain reports in an email.

## Plain reports

A plain X-ARF report is an email which contains the report in its body. The body type should be multipart/mixed.

These header fields are relevant for `PLAIN` reports:

### Mandatory header fields
* `X-XARF: PLAIN` in upper case according to RFC(2)822   
* `Content-Type: multipart/mixed` with appropriate parameters, e.g. boundary
* Additional header fields required by MIME (MIME-Version, etc)

### Conditional header fields
* `Auto-Submitted: auto-generated` according to RFC3834
  \[mandatory field if the report is autogenerated\]

### Recommended header fields
* <code>Subject: abuse report about *source* - *date*</code> as an easy to use and apprehensible subject line   
* X-DKIM/DKIM-Signature according to RFC5585 and RFC6376 unless otherwise digitally secured (see [secure](#secure))

## Security

A secure report uses S/MIME or PGP/MIME to provide encryption, message integrity, etc.

A report can be signed by transporting it in a message with type `multipart/signed` (RFC1847). The protocol type determines whether S/MIME (`application/pkcs7-signature`, RFC 5751) or PGP/MIME (`application/pgp-signature`, RFC3156) was used. In this case, the first body part described in RFC 1847 sec 2.2 is the multipart/mixed structure containing the report.

A report can be encrypted by transporting it in a message with type `multipart/encrypted` with protocol `application/pgp-encrypted`. This is A PGP/MIME encrypted (RFC3156) report. In this case, the "bare" X-ARF report (MIME header fields followed by the body parts) is encrypted and placed into the second MIME body part, as described in RFC 3156 section 4.

A report can also be encrypted as an S/MIME enveloped-data (RFC5751) with type `application/pkcs7-mime`. We'll need to fill this in - I'm not familiar enough with S/MIME to do so yet.

### Mandatory header fields
* `X-XARF: SECURE`
* `Content-Type: {multipart/signed, multipart/encrypted, application/pkcs7-mime}`

### Conditional header fields
* `Auto-Submitted: auto-generated` according to RFC3834
  \[mandatory field if the report is autogenerated\]

#### Recommended header fields
* <code>Subject: abuse report about *source* - *date*</code> as an easy to use and apprehensible subject line   

## Bulk

The simplest approach here is just to have a multipart/mixed of multipart/mixed, with no other indicator necessary. But that might be a bit fragile. Let's take that approach for the moment and revise if necessary.

For bulk reports via SMTP, multiple PLAIN reports are simply attached to an email, along with the `X-XARF: BULK` header. The top-level message should be parsed into separate multipart/mixed messages, each of which should be treated as a spearate plain report.

### Mandatory header fields
* `X-XARF: BULK` in upper case according to RFC(2)822   
* `Content-Type: multipart/mixed`

### Conditional header fields
* `Auto-Submitted: auto-generated` according to RFC3834

### Recommended header fields
* <code>Subject: Multiple abuse reports</code> 
* X-DKIM/DKIM-Signature according to RFC5585 and RFC6376
